<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Easter Campaign - Big Bus Tours</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://unpkg.com/alpinejs" defer></script>
        <style>
            html, body {
                padding: 0;
                margin: 0;
                height: 100%;
            }
        </style>
    </head>
    <body class="bg-[#AA0A2F] min-h-screen flex flex-col items-center justify-center text-white" x-data="{ open: false }">
        <h1 class="text-center text-[24px] md:text-[55px] font-bold py-[20px] md:py-[40px] px-[40px] xl:px-[200px]">
            Find all the Easter Eggs for a chance to win Big Bus Tour tickets!
        </h1>
        <button 
            @click="open = true"
            class="bg-white text-[#AA0A2F] font-bold py-2 px-4 md:py-3 md:px-6 rounded-lg shadow-md hover:bg-[#FFDD00] transition"
        >
            ENTER COMPETITION
        </button>
        <div 
            x-show="open"
            x-transition
            class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-60 z-50 p-[40px]"
            x-cloak
        >
            <div class="w-full max-w-2xl flex justify-center">
                <div class="bg-[#AA0A2F] p-8 rounded shadow-md w-full max-w-md relative" x-data="{
                    formData: {
                        first_name: '',
                        last_name: '',
                        email: '',
                        country: '',
                        answer: '',
                        terms: false
                    },
                    answers: ['5 Eggs', '7 Eggs', '9 Eggs', '11 Eggs', '13 Eggs'],

                    // DELETE THESE BEFORE DEPLOYING
                    // const app_id = 'J66N00EIXFL3G0NFKB306NIH';
                    // const username = '';
                    // const password = 'nRQd0SxyhFnYlU5gdKOvC1M5';

                    submitForm() {
                        if (!this.formData.terms) {
                            alert('Please accept the terms and conditions.');
                            return;
                        }

                        const userData = {
                            type: 'customer',
                            customer_id: this.formData.email,
                            update_existing_only: 'false',
                            attributes: {
                                first_name: this.formData.first_name,
                                last_name: this.formData.last_name,
                                email: this.formData.email,
                                country: this.formData.country,
                                answer: this.formData.answer
                            }
                        };

                        fetch('/api/send', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(userData)
                        })
                        .then(response => {
                            if (!response.ok) {
                                return response.text().then(text => { throw new Error(`HTTP error! status: ${response.status}, body: ${text}`) });
                            }
                            return response.json();
                        })
                        .then(data => {
                            alert('Form submitted successfully!');
                            console.log('Success:', data);
                            this.formData = {
                                first_name: '',
                                last_name: '',
                                email: '',
                                country: '',
                                answer: '',
                                terms: false
                            };
                        })
                        .catch((error) => {
                            alert('Error submitting form.');
                            console.error('Error:', error);
                        });
                    }
                }">
                    <button 
                        @click="open = false"
                        class="absolute top-2 right-[1rem] text-black text-2xl"
                        aria-label="Close modal"
                    >
                        &times;
                    </button>
                    <form @submit.prevent="submitForm">
                        <div class="mb-4">
                            <label for="first_name" class="block text-white text-sm mb-2">First Name:</label>
                            <input type="text" id="first_name" x-model="formData.first_name" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                        </div>
            
                        <div class="mb-4">
                            <label for="last_name" class="block text-white text-sm mb-2">Last Name:</label>
                            <input type="text" id="last_name" x-model="formData.last_name" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                        </div>
            
                        <div class="mb-4">
                            <label for="email" class="block text-white text-sm mb-2">Email Address:</label>
                            <input type="email" id="email" x-model="formData.email" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                        </div>
            
                        <div class="mb-4">
                            <div class="mb-4" x-data="{
                                search: '',
                                selected: '',
                                showOptions: false,
                                countries: ['Afghanistan', 'Albania', 'Algeria', 'Andorra', 'Angola', 'Antigua and Barbuda', 'Argentina', 'Armenia', 'Australia', 'Austria', 'Azerbaijan', 'Bahamas', 'Bahrain', 'Bangladesh', 'Barbados', 'Belarus', 'Belgium', 'Belize', 'Benin', 'Bhutan', 'Bolivia', 'Bosnia and Herzegovina', 'Botswana', 'Brazil', 'Brunei', 'Bulgaria', 'Burkina Faso', 'Burundi', 'Cabo Verde', 'Cambodia', 'Cameroon', 'Canada', 'Central African Republic', 'Chad', 'Chile', 'China', 'Colombia', 'Comoros', 'Congo', 'Costa Rica', 'Croatia', 'Cuba', 'Cyprus', 'Czech Republic', 'Democratic Republic of the Congo', 'Denmark', 'Djibouti', 'Dominica', 'Dominican Republic', 'Ecuador', 'Egypt', 'El Salvador', 'Equatorial Guinea', 'Eritrea', 'Estonia', 'Eswatini', 'Ethiopia', 'Fiji', 'Finland', 'France', 'Gabon', 'Gambia', 'Georgia', 'Germany', 'Ghana', 'Greece', 'Grenada', 'Guatemala', 'Guinea', 'Guinea-Bissau', 'Guyana', 'Haiti', 'Honduras', 'Hungary', 'Iceland', 'India', 'Indonesia', 'Iran', 'Iraq', 'Ireland', 'Israel', 'Italy', 'Jamaica', 'Japan', 'Jordan', 'Kazakhstan', 'Kenya', 'Kiribati', 'Kuwait', 'Kyrgyzstan', 'Laos', 'Latvia', 'Lebanon', 'Lesotho', 'Liberia', 'Libya', 'Liechtenstein', 'Lithuania', 'Luxembourg', 'Madagascar', 'Malawi', 'Malaysia', 'Maldives', 'Mali', 'Malta', 'Marshall Islands', 'Mauritania', 'Mauritius', 'Mexico', 'Micronesia', 'Moldova', 'Monaco', 'Mongolia', 'Montenegro', 'Morocco', 'Mozambique', 'Myanmar', 'Namibia', 'Nauru', 'Nepal', 'Netherlands', 'New Zealand', 'Nicaragua', 'Niger', 'Nigeria', 'North Korea', 'North Macedonia', 'Norway', 'Oman', 'Pakistan', 'Palau', 'Palestine', 'Panama', 'Papua New Guinea', 'Paraguay', 'Peru', 'Philippines', 'Poland', 'Portugal', 'Qatar', 'Romania', 'Russia', 'Rwanda', 'Saint Kitts and Nevis', 'Saint Lucia', 'Saint Vincent and the Grenadines', 'Samoa', 'San Marino', 'Sao Tome and Principe', 'Saudi Arabia', 'Senegal', 'Serbia', 'Seychelles', 'Sierra Leone', 'Singapore', 'Slovakia', 'Slovenia', 'Solomon Islands', 'Somalia', 'South Africa', 'South Korea', 'South Sudan', 'Spain', 'Sri Lanka', 'Sudan', 'Suriname', 'Sweden', 'Switzerland', 'Syria', 'Tajikistan', 'Tanzania', 'Thailand', 'Timor-Leste', 'Togo', 'Tonga', 'Trinidad and Tobago', 'Tunisia', 'Turkey', 'Turkmenistan', 'Tuvalu', 'Uganda', 'Ukraine', 'United Arab Emirates', 'United Kingdom', 'United States', 'Uruguay', 'Uzbekistan', 'Vanuatu', 'Vatican City', 'Venezuela', 'Vietnam', 'Yemen', 'Zambia', 'Zimbabwe'],
                                filteredCountries() {
                                    return this.countries.filter(c => c.toLowerCase().includes(this.search.toLowerCase()));
                                },
                                choose(country) {
                                    this.selected = country;
                                    this.search = country;
                                    this.showOptions = false;
                                    formData.country = country;
                                }
                            }">
                                <label class="block text-white text-sm mb-2">Country:</label>
                                <div class="relative">
                                    <input 
                                        type="text" 
                                        x-model="search" 
                                        @focus="showOptions = true" 
                                        @click.away="showOptions = false"
                                        @keydown.escape="showOptions = false"
                                        class="shadow border rounded w-full py-2 px-3 text-gray-700 focus:outline-none focus:shadow-outline placeholder-gray-700 leading-tight"
                                        placeholder="Search or select a country"
                                        required
                                    >
                                    <template x-if="showOptions">
                                        <ul class="absolute z-10 w-full bg-white border mt-1 rounded max-h-60 overflow-y-auto text-gray-700">
                                            <template x-for="country in filteredCountries()" :key="country">
                                                <li 
                                                    @click="choose(country)"
                                                    class="px-4 py-2 hover:bg-gray-200 cursor-pointer"
                                                    x-text="country"
                                                ></li>
                                            </template>
                                        </ul>
                                    </template>
                                </div>
                            </div>
                        </div>
            
                        <div class="mb-4">
                            <label for="answer" class="block text-white text-sm mb-2">Answer:</label>
                            <select id="answer" x-model="formData.answer" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                                <option value="" disabled selected>Select an answer</option>
                                <template x-for="ans in answers" :key="ans">
                                    <option :value="ans" x-text="ans"></option>
                                </template>
                            </select>
                        </div>
            
                        <div class="mb-4">
                            <label class="inline-flex items-center">
                                <input type="checkbox" x-model="formData.terms" class="form-checkbox h-5 w-5 text-[#FFDD00]">
                                <span class="ml-2 text-white text-sm">I agree to the <a href="#" class="text-[#FFDD00]">terms and conditions</a></span>
                            </label>
                        </div>
            
                        <div class="flex items-center justify-end">
                            <button type="submit" class="bg-white text-[#AA0A2F] font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline hover:bg-[#FFDD00] transition">
                                Submit
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </body>
</html>
